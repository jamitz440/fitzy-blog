---
import { Image } from "astro:assets";
import { getCollection } from "astro:content";
import BaseHead from "../../components/BaseHead.astro";
import FormattedDate from "../../components/FormattedDate.astro";
import Header from "../../components/Header.astro";
import { SITE_DESCRIPTION, SITE_TITLE, TAGS } from "../../consts";
import { Font } from "astro:assets";

const posts = (await getCollection("blog")).sort(
    (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);

// Calculate reading time based on word count (average reading speed: 200 words/min)
function getReadingTime(content: string) {
    const words = content.trim().split(/\s+/).length;
    const minutes = Math.ceil(words / 200);
    return `${minutes} min read`;
}

const postsWithReadingTime = posts.map((post) => ({
    ...post,
    readingTime: getReadingTime(post.body),
}));
---

<!doctype html>
<html lang="en">
    <head>
        <BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
        <style>
            main {
                width: 720px;
            }
            ul {
                list-style-type: none;
                margin: 0;
                padding: 0;
            }
            ul li {
                margin-bottom: 1.5rem;
                padding-bottom: 1.5rem;
                border-bottom: 1px solid var(--surface);
            }
            ul li:last-child {
                border-bottom: none;
            }
            ul li a {
                display: block;
                text-decoration: none;
                transition: all 0.2s ease;
            }
            ul li a:hover {
                transform: translateX(0.5rem);
            }
            .title {
                margin: 0 0 0.25rem 0;
                color: var(--accent);
                line-height: 1.3;
                font-size: 1.3rem;
            }
            ul li a:hover .title {
                color: var(--accent-light);
            }
            .date {
                margin: 0;
                color: var(--light-muted);
                font-size: 0.85rem;
            }
            .meta {
                display: flex;
                gap: 0.75rem;
                align-items: center;
            }
            .reading-time {
                color: var(--light-accent);
            }
            .reading-time::before {
                content: "â€¢";
                margin-right: 0.75rem;
            }
            .description {
                margin: 0.5rem 0 0 0;
                color: var(--light);
                line-height: 1.5;
                font-size: 0.95rem;
            }
            @media (max-width: 720px) {
                ul li {
                    margin-bottom: 1.25rem;
                    padding-bottom: 1.25rem;
                }
                .title {
                    font-size: 1.1rem;
                }
            }
        </style>
    </head>
    <body>
        <Header />
        <main>
            <section>
                <ul>
                    {
                        postsWithReadingTime.map((post) => (
                            <li>
                                <a href={`/blog/${post.id}/`}>
                                    <h4 class="title">{post.data.title}</h4>
                                    <div class="meta">
                                        <p class="date">
                                            <FormattedDate
                                                date={post.data.pubDate}
                                            />
                                        </p>
                                        <span class="reading-time">
                                            {post.readingTime}
                                        </span>
                                    </div>
                                    {post.data.tags && post.data.tags.map((tag) => (
                                        <span class="tag" style=`background: var(${TAGS[tag]}`>{tag}</span>
                                    ))}

                                    {post.data.description && (
                                        <p class="description">
                                            {post.data.description}
                                        </p>
                                    )}
                                </a>
                            </li>
                        ))
                    }
                </ul>
            </section>
        </main>
    </body>
</html>
