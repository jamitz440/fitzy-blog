---
import { getCollection } from "astro:content";
import BaseHead from "../components/BaseHead.astro";
import FormattedDate from "../components/FormattedDate.astro";
import Header from "../components/Header.astro";
import { SITE_DESCRIPTION, SITE_TITLE } from "../consts";

// Get the 5 most recent posts
const posts = (await getCollection("blog"))
    .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
    .slice(0, 5);
---

<!doctype html>
<html lang="en">
    <head>
        <BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
        <style>
            .intro {
                margin-bottom: 3rem;
            }

            .intro h1 {
                font-size: 2.5rem;
                margin-bottom: 0.5rem;
            }

            .tagline {
                color: var(--light-accent);
                font-size: 1.1rem;
                margin-bottom: 1rem;
            }

            .bio {
                color: var(--light);
                line-height: 1.6;
                max-width: 650px;
            }

            .recent-posts {
                margin-top: 3rem;
            }

            .recent-posts h2 {
                font-size: 1.5rem;
                margin-bottom: 1.5rem;
                color: var(--accent);
            }

            .posts-list {
                list-style: none;
                padding: 0;
                margin: 0;
            }

            .post-item {
                margin-bottom: 1.25rem;
                padding: 1rem;
                background: var(--dark-1);
                border-radius: 0px 8px 8px 0px;
                transition: all 0.2s ease;
            }

            .post-item:hover {
                transform: translateX(0.5rem);
                border-left: 3px solid var(--accent);
            }

            .post-item a {
                text-decoration: none;
                display: block;
            }

            .post-title {
                color: var(--accent);
                font-size: 1.15rem;
                margin: 0 0 0.5rem 0;
                transition: color 0.2s ease;
            }

            .post-item:hover .post-title {
                color: var(--accent-light);
            }

            .post-meta {
                display: flex;
                gap: 0.5rem;
                align-items: center;
                color: var(--light-muted);
                font-size: 0.85rem;
            }

            .post-description {
                margin: 0.5rem 0 0 0;
                color: var(--light);
                font-size: 0.9rem;
                line-height: 1.5;
            }

            .view-all {
                display: inline-block;
                margin-top: 1.5rem;
                color: var(--light-accent);
                text-decoration: none;
                font-weight: 700;
                transition: color 0.2s ease;
            }

            .view-all:hover {
                color: var(--accent);
            }

            .view-all::after {
                content: " â†’";
            }

            @media (max-width: 720px) {
                .intro h1 {
                    font-size: 2rem;
                }

                .tagline {
                    font-size: 1rem;
                }

                .post-item:hover {
                    transform: translateX(0.25rem);
                }
            }
        </style>
    </head>
    <body>
        <Header />
        <main>
            <div class="intro">
                <h1>Hey, I'm Fitzy!</h1>
                <p class="tagline">
                    Software developer, Linux enthusiast, hobby-switcher
                </p>
                <p class="bio">
                    I write about whatever's caught my attention lately. Whether
                    that's solving software problems, discovering useful Linux
                    tools, taking control of my data and privacy, diving into 3D
                    printing, or anything else that seems interesting to me.
                    <br />No theme, no plan, as usual.
                </p>
            </div>

            <section class="recent-posts">
                <h2>recent posts</h2>
                <ul class="posts-list">
                    {
                        posts.map((post) => (
                            <li class="post-item">
                                <a href={`/blog/${post.id}/`}>
                                    <h3 class="post-title">
                                        {post.data.title}
                                    </h3>
                                    <div class="post-meta">
                                        <FormattedDate
                                            date={post.data.pubDate}
                                        />
                                    </div>
                                    {post.data.description && (
                                        <p class="post-description">
                                            {post.data.description}
                                        </p>
                                    )}
                                </a>
                            </li>
                        ))
                    }
                </ul>
                <a href="/blog" class="view-all">view all posts</a>
            </section>
        </main>
    </body>
</html>
